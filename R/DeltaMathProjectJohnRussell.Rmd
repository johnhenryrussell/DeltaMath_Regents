---
title: "A Complete Analyis of the Algebra I Regents Exam"
author: "John Russell"
date: "2023-01-20"
output:
  pdf_document: default
  html_document:
    df_print: paged
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Below is a sample of the data that we have collected.

```{r echo=FALSE, message=FALSE, warning=FALSE, results='asis'}
library(dplyr)

df <- read.csv("dmathdata.csv", header = TRUE)
df <- subset(df, select=-c(X, X.1))

df <- na.omit(df)

attach(df)

df.table <- df %>% select(Question.Number, Standard, Percentage.Correct)
df.table <- slice(df.table, c(5,24,23,75,38,11))

library(gt)
library(gtExtras)


library(knitr)
kable(df.table, format= "markdown")


```


# Classification

### To classify the data by difficulty levels, we will use a common technique called "Jenks Natural Breaks Classification." This method seeks to minimize the average deviation from the class mean while maximizing the deviation from the means of the other groups. The result is the arrangement of a set of values into "natural" classes.

```{r message=FALSE, warning=FALSE}
library(BAMMtools)
breaks <- getJenksBreaks(df$Percentage.Correct, 4)
breaks
```


### The above output gives us three intervals of percentage scores. We will use these to classify the exam questions as "Easy", "Normal", or "Hard".

```{r echo=FALSE}
hard <- filter(df, Percentage.Correct >= breaks[1] & 
                       Percentage.Correct < breaks[2])

normal <- filter(df, Percentage.Correct >= breaks[2] & 
                          Percentage.Correct < breaks[3])

easy <- filter(df, Percentage.Correct >= breaks[3] & 
                       Percentage.Correct < breaks[4])

df <- mutate(df, Difficulty = 
                     case_when(Percentage.Correct >= breaks[1] & 
                                                Percentage.Correct < breaks[2] ~ "Hard",
                                        Percentage.Correct >= breaks[2] & 
                                                Percentage.Correct < breaks[3] ~ "Normal",
                                        Percentage.Correct >= breaks[3] & 
                                                Percentage.Correct <= breaks[4] ~ "Easy"))


diff.df <- data.frame(c("Easy", "Normal", "Hard"), c(mean(easy$Percentage.Correct*100), 
                                                     mean(normal$Percentage.Correct*100), 
                                                     mean(hard$Percentage.Correct*100)))

colnames(diff.df) <- c("Difficulty", "Percentage Correct (Mean)")

kable(diff.df)



```


### Below is the same sample with a "Difficulty" column added.

```{r echo=FALSE}
df.table.diff <- df %>% select(Question.Number, Standard, Percentage.Correct, Difficulty )
df.table.diff <- slice(df.table.diff, c(5,24,23,75,38,11))
kable(df.table.diff)
```


# Plots

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height=6}
library(patchwork)
library(ggplot2)

easy.plot <- ggplot(data = easy, aes(x=Standard)) + 
        geom_bar(aes(fill = Standard, y= (..count..)/sum(..count..))) + 
        labs(title = "Easy", x="", y="Percent") + 
        guides(fill="none") + 
        scale_y_continuous(breaks = c(0, .10, .20, .3), 
                           labels=c("0%", "10%", "20%", "30%"),
                           limits = c(0,.35)) 

normal.plot <- ggplot(data = normal, aes(x=Standard)) + 
        geom_bar(aes(fill = Standard, y= (..count..)/sum(..count..))) + 
        labs(title="Normal", x="", y="Percent") +
        guides(fill="none") + 
        scale_y_continuous(breaks = c(0, .10, .20, .3), 
                           labels=c("0%", "10%", "20%", "30%"),
                           limits = c(0,.35))

hard.plot <- ggplot(data = hard, aes(x=Standard)) + 
        geom_bar(aes(fill = Standard, y= (..count..)/sum(..count..))) + 
        labs(title = "Hard", x="", y="Percent") + 
        guides(fill="none") + 
        scale_y_continuous(breaks = c(0, .10, .20, .3), 
                           labels=c("0%", "10%", "20%", "30%"),
                           limits = c(0,.35)) + 
        scale_x_discrete(limits = c("A-APR", "A-CED", "A-REI", "A-SSE", "F-BF", "F-IF", "F-LE", "N-Q", "N-RN", "S-ID"))



design <- c(
        area(10,10),
        area(10,10),
        area(10,10)
        
)

plot.1 <- easy.plot / normal.plot/ hard.plot + 
        plot_annotation(theme = theme_gray(base_family = 'mono'),
                                                              title = "Distribution of Standards across Difficulty Levels")

plot.1
```

### It's important to notice that **F-IF**, or the domain "Interpreting Functions" is found in high frequency across the three difficulty levels. Let's examine this more closely. 


```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height=6}
library(dplyr)
hard.IF <- filter(hard, Standard == "F-IF")
normal.IF <- filter(normal, Standard == "F-IF")
easy.IF <- filter(easy, Standard == "F-IF")

plot.1 <- ggplot(data = easy.IF, aes(x=Standard.Cluster)) + 
        geom_bar(aes(fill = Standard.Cluster, y= (..count..)/sum(..count..))) + 
        labs(title = "Easy", x="", y="Percent") + 
        guides(fill="none") +
        scale_y_continuous(breaks = c(0, .20, .40, .6), labels = c("0%", "20%", "40%", "60%")) +
        scale_x_discrete(limits = c("F-IF.A", "F-IF.B", "F-IF.C"))
        
plot.2 <- ggplot(data = normal.IF, aes(x=Standard.Cluster)) + 
        geom_bar(aes(fill = Standard.Cluster, y= (..count..)/sum(..count..))) + 
        labs(title = "Normal", x="", y="Percent") + 
        guides(fill="none") +
        scale_y_continuous(breaks = c(0, .20, .40, .6), labels = c("0%", "20%", "40%", "60%"))

plot.3 <- ggplot(data = hard.IF, aes(x=Standard.Cluster)) + 
        geom_bar(aes(fill = Standard.Cluster, y= (..count..)/sum(..count..))) + 
        labs(title = "Hard", x="", y="Percent") + 
        guides(fill="none") +
        scale_y_continuous(breaks = c(0, .20, .40, .6), labels = c("0%", "20%", "40%", "60%"))

fig <- plot.1 / plot.2 / plot.3  + 
        plot_annotation(theme = theme_gray(base_family = 'mono'),
                                                              title = "Distribution of F-IF Standard across Difficulty Levels")
fig

```

